{"version":3,"file":"hyperswarm-web.js","sources":["../index.js"],"sourcesContent":["import { EventEmitter } from 'events'\nimport DHT from '@hyperswarm/dht'\nimport b4a from 'b4a'\n\nexport default class HyperswarmWeb extends EventEmitter {\n  constructor (opts = {}) {\n    super()\n    this.opts = {\n      bootstrap: opts.bootstrap || [\n        'wss://bootstrap1.hyperdht.org',\n        'wss://bootstrap2.hyperdht.org',\n        'wss://bootstrap3.hyperdht.org'\n      ],\n      maxPeers: opts.maxPeers || 24,\n      keyPair: opts.keyPair || DHT.keyPair()\n    }\n\n    this.peers = new Map()\n    this.topics = new Map()\n    this.discoveries = new Map()\n    this.connections = new Set()\n    this.destroyed = false\n    this.dht = null\n  }\n\n  normalizeTopic(topic) {\n    if (!topic) throw new Error('Topic cannot be null or undefined')\n    if (typeof topic === 'string' && !topic.trim()) throw new Error('Topic cannot be empty')\n    return typeof topic === 'string' ? b4a.from(topic) : topic\n  }\n\n  async initDHT() {\n    if (this.destroyed) throw new Error('Cannot initialize DHT on destroyed swarm')\n    if (this.dht) return this.dht\n\n    this.dht = new DHT({\n      bootstrap: [\n        { host: 'bootstrap1.hyperdht.org', port: 49737 },\n        { host: 'bootstrap2.hyperdht.org', port: 49737 },\n        { host: 'bootstrap3.hyperdht.org', port: 49737 }\n      ],\n      keyPair: this.opts.keyPair\n    })\n\n    await this.dht.ready()\n    return this.dht\n  }\n\n  async join(topic, opts = {}) {\n    if (this.destroyed) throw new Error('Cannot join topic on destroyed swarm')\n    if (this.peers.size >= this.opts.maxPeers) throw new Error(`Exceeded maximum peer limit of ${this.opts.maxPeers}`)\n\n    const normalizedTopic = this.normalizeTopic(topic)\n    const topicKey = b4a.toString(normalizedTopic, 'hex')\n\n    const discovery = {\n      announce: opts.announce !== false,\n      lookup: opts.lookup !== false,\n      topic: normalizedTopic\n    }\n\n    this.discoveries.set(topicKey, discovery)\n    this.topics.set(topicKey, normalizedTopic)\n\n    await this.initDHT()\n    await this.dht.join(normalizedTopic)\n\n    return discovery\n  }\n\n  async leave(topic) {\n    const normalizedTopic = this.normalizeTopic(topic)\n    const topicKey = b4a.toString(normalizedTopic, 'hex')\n    const discovery = this.discoveries.get(topicKey)\n    \n    if (discovery) {\n      await this.dht?.leave(normalizedTopic)\n      this.discoveries.delete(topicKey)\n      this.topics.delete(topicKey)\n    }\n  }\n\n  async destroy() {\n    if (this.destroyed) return\n    this.destroyed = true\n\n    for (const [_, discovery] of this.discoveries) {\n      await this.leave(discovery.topic)\n    }\n\n    if (this.dht) {\n      await this.dht.destroy()\n      this.dht = null\n    }\n\n    this.peers.clear()\n    this.topics.clear()\n    this.discoveries.clear()\n    this.connections.clear()\n  }\n}\n"],"names":[],"mappings":"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"}